<h1>
    <center>
    playwright学习
    </center>
</h1>

web自动化测试的时候早就听闻playwright这个框架了，由微软主导维护，相比于selenium速度更快(绕过了中间的驱动层)， 且playwright的等待做得更好。
官网：https://playwright.dev/python/docs/intro
以下内容是官网给的入门配置，说实话我要不是有自动测试的基础真尼玛看不懂他写什么鬼。可以肯定的就是web自动化测试都是可以迁移的，该有的东西都有，像是夹具、pytest的ini配置等等都是通用的。
# 安装
Playwright 建议使用官方的Playwright Pytest 插件来编写端到端测试。它提供上下文隔离，开箱即用，可在多种浏览器配置上运行。

首先安装 Playwright 并运行示例测试，即可查看其运行效果。

安装Pytest 插件：
```
pip install pytest-playwright
```
安装所需的浏览器：
```
playwright install
```

## 添加示例
在当前工作目录或其子目录中创建一个遵循test_前缀约定的文件，例如`.test.js`，并添加以下代码。请确保您的测试名称也遵循前缀约定。test_example.pytest_
test_example.py
```python
import re
from playwright.sync_api import Page, expect

def test_has_title(page: Page):
    page.goto("https://playwright.dev/")

    # Expect a title "to contain" a substring.
    expect(page).to_have_title(re.compile("Playwright"))

def test_get_started_link(page: Page):
    page.goto("https://playwright.dev/")

    # Click the get started link.
    page.get_by_role("link", name="Get started").click()

    # Expects page to have a heading with the name of Installation.
    expect(page.get_by_role("heading", name="Installation")).to_be_visible()
```
## 运行示例
默认情况下，测试将在 Chromium 内核上运行。这可以通过命令行选项进行配置。测试以无头模式运行，这意味着运行测试时不会打开任何浏览器界面。测试结果和测试日志将显示在终端中。
```
pytest
```

## 更新
要将 Playwright 更新到最新版本，请运行以下命令：
```
pip install pytest-playwright playwright -U
```
## 系统
Python 3.8 或更高版本。
Windows 11+、Windows Server 2019+ 或 Windows 子系统 Linux 版 (WSL)。
macOS 14 Ventura 或更高版本。
Debian 12、Debian 13、Ubuntu 22.04、Ubuntu 24.04，支持 x86-64 和 arm64 架构。

***

# 编写测试
简介
Playwright测试非常简单，它们：

- 执行操作，
- 并基于预期验证状态。

在执行操作之前无需等待任何条件：Playwright会在执行每个操作前自动等待一系列可操作性检查通过。
同时，在执行检查时也无需处理竞争条件问题——Playwright断言的设计旨描述最终需要满足的预期条件。

就是这样！这些设计选择让Playwright用户可以完全摆脱测试中难以预测的超时和竞争条件检查的困扰。

您将学习：
- 如何编写第一个测试
- 如何执行操作
- 如何使用断言
- 测试如何隔离运行
- 如何使用测试钩子

## 第一个测试
请查看以下示例以了解如何编写测试。注意文件名遵循 test_ 前缀的命名约定，每个测试名称也遵循相应规范。
test_example.py
```
import re
from playwright.sync_api import Page, expect

def test_has_title(page: Page):
    page.goto("https://playwright.dev/")

    # Expect a title "to contain" a substring.
    expect(page).to_have_title(re.compile("Playwright"))

def test_get_started_link(page: Page):
    page.goto("https://playwright.dev/")

    # Click the get started link.
    page.get_by_role("link", name="Get started").click()

    # Expects page to have a heading with the name of Installation.
    expect(page.get_by_role("heading", name="Installation")).to_be_visible()
```

## 操作
### 页面导航
大多数测试将从导航到指定URL页面开始。之后，测试人员将能够与页面元素进行交互。
```
page.goto("https://playwright.dev/")
```
Playwright 会等待页面加载完毕后再继续执行。了解更多关于page.goto()选项的信息。 

### 交互操作
执行操作首先需要定位元素。Playwright使用定位器API实现此功能。定位器表示在任意时刻查找页面上元素的方法，详细了解不同类型的定位器。Playwright会在执行操作前等待元素可交互，因此无需额外等待元素可用。
```
# 创建定位器
get_started = page.get_by_role("link", name="Get started")

# 点击元素
get_started.click()
```

多数情况下会简写为单行：
```
page.get_by_role("link", name="Get started").click()
```

### 基础操作
以下是Playwright最常用的操作列表（更多操作请查阅[定位器API文档](https://playwright.dev/docs/api/class-locator)）：

| 操作                        | 描述                  |
| --------------------------- | --------------------- |
| `locator.check()`           | 勾选复选框            |
| `locator.click()`           | 点击元素              |
| `locator.uncheck()`         | 取消勾选复选框        |
| `locator.hover()`           | 鼠标悬停元素          |
| `locator.fill()`            | 填充表单字段/输入文本 |
| `locator.focus()`           | 聚焦元素              |
| `locator.press()`           | 按下单个按键          |
| `locator.set_input_files()` | 选择上传文件          |
| `locator.select_option()`   | 选择下拉框选项        |

## 断言
Playwright包含的断言会持续等待直到满足预期条件。使用这些断言能确保测试的稳定性和可靠性。例如以下代码会等待页面标题包含"Playwright"：

```python
import re
from playwright.sync_api import expect

expect(page).to_have_title(re.compile("Playwright"))
```

以下是常用的异步断言列表（更多断言请深入学习）：

| 断言                                  | 描述                 |
| ------------------------------------- | -------------------- |
| `expect(locator).to_be_checked()`     | 复选框已勾选         |
| `expect(locator).to_be_enabled()`     | 控件已启用           |
| `expect(locator).to_be_visible()`     | 元素可见             |
| `expect(locator).to_contain_text()`   | 元素包含文本         |
| `expect(locator).to_have_attribute()` | 元素具有属性         |
| `expect(locator).to_have_count()`     | 元素列表具有指定长度 |
| `expect(locator).to_have_text()`      | 元素匹配文本         |
| `expect(locator).to_have_value()`     | 输入框具有值         |
| `expect(page).to_have_title()`        | 页面具有标题         |
| `expect(page).to_have_url()`          | 页面具有URL          |

## 测试隔离
Playwright Pytest插件基于测试固件的概念构建，例如内置的`page`固件会传递给测试。由于浏览器上下文的存在，测试间的页面是隔离的（每个上下文相当于全新的浏览器配置），因此每个测试都获得全新环境，即使在单个浏览器中运行多个测试也是如此。

**test_example.py**
```python
from playwright.sync_api import Page

def test_example_test(page: Page):
    # "page"属于为此测试创建的独立浏览器上下文
    pass

def test_another_test(page: Page):
    # 第二个测试中的"page"与第一个测试完全隔离
    pass
```

## 使用固件
可通过多种固件在测试前后执行代码，或在测试间共享对象。函数作用域的固件（如配合`autouse`）类似于`beforeEach/afterEach`，模块作用域的固件（配合`autouse`）则类似于`beforeAll/afterAll`，在所有测试前后运行。

**test_example.py**
```python
import pytest
from playwright.sync_api import Page, expect

@pytest.fixture(scope="function", autouse=True)
def before_each_after_each(page: Page):
    print("测试执行前")
    # 每个测试前跳转到起始URL
    page.goto("https://playwright.dev/")
    yield
    print("测试执行后")

def test_main_navigation(page: Page):
    # 断言使用expect API
    expect(page).to_have_url("https://playwright.dev/")
```

## 后续步骤
- 运行单个测试、多个测试、有头模式  
- 通过代码生成器生成测试  
- 查看测试追踪记录  
- 使用GitHub Actions在CI上运行测试


***


# 生成测试
## 简介
Playwright可以自动生成测试，为快速开始测试提供便捷方式。通过代码生成功能，系统将打开浏览器窗口进行交互，同时启动Playwright检查器用于记录、复制和管理生成的测试。

**您将学习：**  
- 如何记录测试  
- 如何生成定位器  

## 运行代码生成
使用`codegen`命令启动测试生成器，后接需要生成测试的网站URL（URL为可选参数，如果省略可直接在浏览器窗口中添加）。

```bash
playwright codegen demo.playwright.dev/todomvc
```

## 记录测试 
运行代码生成功能并在浏览器中执行操作，Playwright会自动为您的交互生成代码。代码生成器会分析渲染页面并推荐最佳定位器，优先使用角色定位器、文本定位器和测试ID定位器。当多个元素匹配同一定位器时，生成器将优化定位器以唯一标识目标元素，从而减少测试失败和不稳定问题。

通过测试生成器您可以记录：  
- **操作**：如通过页面交互记录点击或填充操作  
- **断言**：点击工具栏图标后，再点击页面元素进行断言。可选择：  
  - "断言可见性"：断言元素可见  
  - "断言文本"：断言元素包含特定文本  
  - "断言值"：断言元素具有特定值  

![记录测试](https://playwright.dev/python/assets/images/record-test-python-f8cedafb52b7381780a887b20a450bf5.png)

当完成页面交互后，点击"记录"按钮停止录制，使用"复制"按钮将生成的代码复制到编辑器中。  

使用"清除"按钮清空代码并重新开始记录。完成后，关闭Playwright检查器窗口或停止终端命令。  

要了解更多关于生成测试的信息，请查看我们的[代码生成详细指南](https://playwright.dev/docs/codegen)。

## 生成定位器
您可以使用测试生成器生成定位器：  
1. 点击"记录"按钮停止录制，"选择定位器"按钮将出现  
2. 点击"选择定位器"按钮，将鼠标悬停在浏览器窗口中的元素上，可看到每个元素下方高亮显示的定位器  
3. 点击需要定位的元素，该定位器的代码将显示在"选择定位器"按钮旁边的定位器调试区  
4. 在定位器调试区编辑定位器进行微调，浏览器窗口中将高亮显示匹配元素  
5. 使用复制按钮复制定位器并粘贴到代码中  

![选择定位器](https://playwright.dev/python/assets/images/pick-locator-python-042226bb6d5fe7cdf2450b2b8d46354a.png)

**模拟功能**  
您可以使用模拟功能生成测试，模拟特定视口、设备、配色方案、地理位置、语言或时区。测试生成器还能保留身份验证状态。查看[测试生成器指南](https://playwright.dev/docs/test-generator)了解更多信息。

***

# 运行与调试测试
## 简介
您可以运行单个测试、一组测试或全部测试。通过`--browser`标志，测试可在单一浏览器或多个浏览器上运行。默认情况下，测试以无头模式运行，这意味着运行测试时不会打开浏览器窗口，结果将在终端中显示。如果需要，您可以使用`--headed`命令行参数以有头模式运行测试。

**您将学习：**  
- 如何从命令行运行测试  
- 如何调试测试  

## 运行测试
### 命令行
使用`pytest`命令运行测试，默认在Chromium浏览器上执行。测试默认以无头模式运行，即运行过程中不会打开浏览器窗口，结果将在终端显示。

```bash
pytest
```

### 以有头模式运行测试
使用`--headed`标志以有头模式运行测试。这将打开浏览器窗口运行测试，完成后自动关闭。

```bash
pytest --headed
```

### 在不同浏览器上运行测试
使用`--browser`标志后接浏览器名称来指定运行测试的浏览器。

```bash
pytest --browser webkit
```

要同时在多个浏览器上运行测试，可多次使用`--browser`标志并分别指定浏览器。

```bash
pytest --browser webkit --browser firefox
```

### 运行特定测试
运行单个测试文件时，传入要运行的测试文件名。

```bash
pytest test_login.py
```

运行一组测试文件时，传入要运行的多个测试文件名。

```bash
pytest tests/test_todo_page.py tests/test_landing_page.py
```

运行特定测试函数时，使用`-k`参数后接要运行的测试函数名。

```bash
pytest -k test_add_a_todo_item
```

### 并行运行测试
使用`--numprocesses`标志后接进程数以并行运行测试，建议设置为逻辑CPU核心数的一半。

```bash
pytest --numprocesses 2
```
（此命令需预先安装pytest-xdist，更多信息请参阅[相关文档](https://pytest-xdist.readthedocs.io/)。）

更多信息请查看[Playwright Pytest使用指南](https://playwright.dev/python/docs/test-runners)或[Pytest文档](https://docs.pytest.org/)了解通用命令行用法。

## 调试测试
由于Playwright基于Python运行，您可以使用任意调试器进行调试，例如Visual Studio Code的Python扩展。Playwright自带Playwright检查器，允许您逐步执行Playwright API调用、查看调试日志并探索定位器。

调试所有测试：
```bash
PWDEBUG=1 pytest -s
```

调试单个测试文件：
```bash
PWDEBUG=1 pytest -s test_example.py
```

调试特定测试：
```bash
PWDEBUG=1 pytest -s -k test_get_started_link
```

这些命令将打开浏览器窗口和Playwright检查器。您可以使用检查器顶部的"单步执行"按钮逐步调试测试，或点击"运行"按钮从头到尾执行测试。测试完成后浏览器窗口将自动关闭。

调试过程中，您可以使用"选择定位器"按钮选取页面元素，查看Playwright用于定位该元素的定位器。还可以编辑定位器并实时观察浏览器窗口中对应元素的高亮显示。使用"复制定位器"按钮可将定位器复制到剪贴板，然后粘贴到测试代码中。

![Playwright检查器](https://github.com/microsoft/playwright/assets/13063165/c94c89c8-f945-460c-a653-7809c6ca50ee)

查看我们的[调试指南](https://playwright.dev/python/docs/debug)以深入了解Playwright检查器及使用浏览器开发者工具进行调试。

***

# 追踪查看器
## 简介
Playwright追踪查看器是一款图形界面工具，可让您浏览已记录的测试追踪信息。这意味着您可以在测试的每个操作步骤间前进或回溯，并直观查看每个操作期间发生的情况。

**您将学习：**  
- 如何记录追踪信息  
- 如何打开追踪查看器  

## 记录追踪信息
通过使用`--tracing`标志运行测试来记录追踪信息：

```bash
pytest --tracing on
```

追踪选项包括：  
- `on`：为每个测试记录追踪信息  
- `off`：不记录追踪信息（默认值）  
- `retain-on-failure`：为每个测试记录追踪信息，但删除成功测试运行中的所有追踪记录  

这将在您的测试结果目录中生成名为`trace.zip`的追踪文件。  

如果您未使用Pytest，请[点击此处](https://playwright.dev/docs/trace-viewer)了解如何记录追踪信息。

## 打开追踪记录
您可以通过Playwright CLI或在浏览器中访问[trace.playwright.dev](https://trace.playwright.dev)打开已保存的追踪文件。请确保提供追踪zip文件的完整路径。打开后，您可以点击每个操作步骤或使用时间轴查看每个操作前后的页面状态。还可以在测试的每个步骤中检查日志、源代码和网络情况。追踪查看器会创建DOM快照，因此您可以完全与其交互，例如打开开发者工具等。

```bash
playwright show-trace trace.zip
```

![Playwright追踪查看器](https://github.com/microsoft/playwright/assets/13063165/10fe3585-8401-4051-b1c2-b2e92ac4c274)

要了解更多信息，请查看我们的[追踪查看器详细指南](https://playwright.dev/docs/trace-viewer)。


***

# 配置持续集成
**简介**  
Playwright测试可在任何CI提供商上运行。本节我们将介绍使用GitHub Actions在GitHub上运行测试。如需了解如何配置其他CI提供商，请查看我们的[持续集成详细文档](https://playwright.dev/docs/ci)。

**您将学习：**  
- 如何设置GitHub Actions  
- 如何查看测试日志  
- 如何查看追踪信息  

**设置GitHub Actions**  
要添加GitHub Actions配置文件，首先创建`.github/workflows`文件夹，并在其中添加包含以下示例代码的`playwright.yml`文件，以便在每次推送到主分支或创建拉取请求时运行测试。

**.github/workflows/playwright.yml**
```yaml
name: Playwright Tests
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v5
    - name: Set up Python
      uses: actions/setup-python@v6
      with:
        python-version: '3.13'
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    - name: Ensure browsers are installed
      run: python -m playwright install --with-deps
    - name: Run your tests
      run: pytest --tracing=retain-on-failure
    - uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}
      with:
        name: playwright-traces
        path: test-results/
```

要了解更多信息，请参阅"[理解GitHub Actions](https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions)"。

查看`jobs.test.steps`中的步骤列表，可见工作流执行以下步骤：  
1. 克隆代码仓库  
2. 安装语言依赖  
3. 安装项目依赖并构建  
4. 安装Playwright浏览器  
5. 运行测试  
6. 上传追踪文件  

## 创建仓库并推送到GitHub
完成GitHub Actions工作流设置后，只需在GitHub上[创建新仓库](https://docs.github.com/en/get-started/quickstart/create-a-repo)或将代码推送到现有仓库。遵循GitHub的说明操作，别忘了使用`git init`命令初始化Git仓库，以便添加、提交和推送代码。

![](https://user-images.githubusercontent.com/13063165/183423254-d2735278-a2ab-4d63-bb99-48d8e5e447bc.png)

## 查看工作流
点击Actions选项卡查看工作流运行情况，这里会显示测试是否通过。

![打开工作流](https://user-images.githubusercontent.com/13063165/183423783-58bf2008-514e-4f96-9c12-c9a55703960c.png)

## 查看测试日志
点击工作流运行记录可查看GitHub执行的所有操作。点击"Run Playwright tests"可查看错误信息、预期结果与实际结果以及调用日志。

![查看测试日志](https://user-images.githubusercontent.com/13063165/183423783-58bf2008-514e-4f96-9c12-c9a55703960c.png)

## 查看追踪信息
[trace.playwright.dev](https://trace.playwright.dev)是追踪查看器的静态托管版本，您可以通过拖放方式上传追踪文件。

![Playwright追踪查看器](https://playwright.dev/python/assets/images/trace-viewer-failed-test-5ec04c65e0f0c1ffca58529f6789c752.png)

## 妥善处理敏感信息
追踪文件或控制台日志等产物包含测试执行信息，可能涉及敏感数据，如测试用户的凭据、预发布后端访问令牌、测试源代码，有时甚至是应用程序源代码。请像对待敏感数据一样谨慎处理这些文件。如果在CI工作流中上传报告和追踪文件，请确保仅上传到受信任的产物存储库，或在上传前加密文件。与团队成员共享产物时同样如此：使用受信任的文件共享服务或在共享前加密文件。

***

# Pytest插件参考
**简介**  
Playwright提供Pytest插件用于编写端到端测试。开始使用前，请参阅[入门指南](https://playwright.dev/python/docs/intro)。

## 使用方法
使用Pytest CLI运行测试：

```bash
pytest --browser webkit --headed
```

若希望自动添加CLI参数而无需每次指定，可使用`pytest.ini`文件：

```ini
# pytest.ini内容
[pytest]
# 使用Firefox并显示UI运行
addopts = --headed --browser firefox
```

## CLI参数
注意：CLI参数仅适用于默认的浏览器、上下文和页面夹具。若通过API调用（如`browser.new_context()`）创建浏览器、上下文或页面，则CLI参数不生效。

- `--headed`：以有头模式运行测试（默认：无头模式）
- `--browser`：在不同浏览器中运行测试：`chromium`、`firefox`或`webkit`。可多次指定以覆盖多个浏览器（默认：`chromium`）
- `--browser-channel`：要使用的浏览器渠道
- `--slowmo`：将Playwright操作速度减慢指定毫秒数。便于观察操作过程（默认：0）
- `--device`：要模拟的设备
- `--output`：测试产出物的存储目录（默认：`test-results`）
- `--tracing`：是否为每个测试记录追踪信息：`on`、`off`或`retain-on-failure`（默认：`off`）
- `--video`：是否为每个测试录制视频：`on`、`off`或`retain-on-failure`（默认：`off`）
- `--screenshot`：是否在每个测试后自动捕获截图：`on`、`off`或`only-on-failure`（默认：`off`）
- `--full-page-screenshot`：失败时是否捕获整页截图。默认仅捕获视口区域，需先启用`--screenshot`（默认：`off`）

## 夹具
本插件为pytest配置了Playwright专用夹具。使用这些夹具时，将夹具名称作为测试函数的参数即可。

```python
def test_my_app_is_working(fixture_name):
    # 使用fixture_name进行测试
    pass
```

### 函数作用域夹具（在测试函数中请求时创建，测试结束时销毁）：
- `context`：为测试创建的新浏览器上下文
- `page`：为测试创建的新浏览器页面
- `new_context`：允许为测试创建不同的浏览器上下文，适用于多用户场景。接受与`browser.new_context()`相同的参数

### 会话作用域夹具（在测试函数中请求时创建，所有测试结束时销毁）：
- `playwright`：Playwright实例
- `browser_type`：当前浏览器的BrowserType实例
- `browser`：Playwright启动的浏览器实例
- `browser_name`：浏览器名称（字符串）
- `browser_channel`：浏览器渠道（字符串）
- `is_chromium`、`is_webkit`、`is_firefox`：对应浏览器类型的布尔值标识

### 自定义夹具选项：对于浏览器和上下文夹具，可使用以下夹具定义自定义启动选项：
- `browser_type_launch_args`：覆盖`browser_type.launch()`的启动参数，应返回字典
- `browser_context_args`：覆盖`browser.new_context()`的选项，应返回字典
- `connect_options`：通过WebSocket端点连接现有浏览器，应返回包含`browser_type.connect()`选项的字典

也可使用`browser_context_args`标记为单个测试覆盖上下文选项：

```python
import pytest

@pytest.mark.browser_context_args(timezone_id="Europe/Berlin", locale="en-GB")
def test_browser_context_args(page):
    assert page.evaluate("window.navigator.userAgent") == "Europe/Berlin"
    assert page.evaluate("window.navigator.languages") == ["de-DE"]
```

## 并行执行：同时运行多个测试
若测试运行在多CPU机器上，可通过`pytest-xdist`同时运行多个测试来加速整个测试套件的执行：

```bash
# 安装依赖
pip install pytest-xdist
# 使用--numprocesses标志
pytest --numprocesses auto
```

根据硬件和测试特性，可将`numprocesses`设置为2到机器CPU核心数之间的值。设置过高可能导致意外行为。

有关pytest选项的通用信息，请参见[运行测试](https://playwright.dev/python/docs/running-tests)。

## 示例
### 配置类型提示实现自动补全
```python
# test_my_application.py
from playwright.sync_api import Page

def test_visit_admin_dashboard(page: Page):
    page.goto("/admin")
    # ...
```

若使用VSCode配合Pylance，启用`python.testing.pytestEnabled`设置后可自动推断类型，无需类型注解。

### 使用多个上下文
为模拟多用户场景，可创建多个`BrowserContext`实例：
```python
# test_my_application.py
from playwright.sync_api import Page, BrowserContext
from pytest_playwright.pytest_playwright import CreateContextCallback

def test_foo(page: Page, new_context: CreateContextCallback) -> None:
    page.goto("https://example.com")
    context = new_context()
    page2 = context.new_page()
    # page和page2处于不同的上下文中
```

### 按浏览器跳过测试
```python
# test_my_application.py
import pytest

@pytest.mark.skip_browser("firefox")
def test_visit_example(page):
    page.goto("https://example.com")
    # ...
```

## 在特定浏览器上运行
```python
# conftest.py
import pytest

@pytest.mark.only_browser("chromium")
def test_visit_example(page):
    page.goto("https://example.com")
    # ...
```

## 使用自定义浏览器渠道（如Google Chrome或Microsoft Edge）
```bash
pytest --browser-channel chrome
```
```python
# test_my_application.py
def test_example(page):
    page.goto("https://example.com")
```

## 配置基础URL
使用`base-url`参数启动Pytest。通过`pytest-base-url`插件实现，允许从配置、CLI参数或夹具设置基础URL：
```bash
pytest --base-url http://localhost:8080
```
```python
# test_my_application.py
def test_visit_example(page):
    page.goto("/admin")
    # -> 将访问 http://localhost:8080/admin
```

## 忽略HTTPS错误
```python
# conftest.py
import pytest

@pytest.fixture(scope="session")
def browser_context_args(browser_context_args):
    return {
        **browser_context_args,
        "ignore_https_errors": True
    }
```

## 使用自定义视口尺寸
```python
# conftest.py
import pytest

@pytest.fixture(scope="session")
def browser_context_args(browser_context_args):
    return {
        **browser_context_args,
        "viewport": {
            "width": 1920,
            "height": 1080,
        }
    }
```

## 设备模拟/浏览器上下文选项覆盖
```python
# conftest.py
import pytest

@pytest.fixture(scope="session")
def browser_context_args(browser_context_args, playwright):
    iphone_11 = playwright.devices['iPhone 11 Pro']
    return {
        **browser_context_args,
        **iphone_11,
    }
```
或通过CLI：`--device="iPhone 11 Pro"`

## 连接远程浏览器
```python
# conftest.py
import pytest

@pytest.fixture(scope="session")
def connect_options():
    return {
        "wsEndpoint": "ws://localhost:8080/ws"
    }
```

## 与unittest.TestCase结合使用
以下示例展示与`unittest.TestCase`的配合使用。注意限制：只能指定单个浏览器，指定多个浏览器时不会生成多浏览器矩阵：
```python
import pytest
import unittest
from playwright.sync_api import Page

class MyTest(unittest.TestCase):
    @pytest.fixture(autouse=True)
    def setup(self, page: Page):
        self.page = page

    def test_foobar(self):
        self.page.goto("https://microsoft.com")
        self.page.locator("#foobar").click()
        assert self.page.evaluate("1 + 1") == 2
```

## 调试
### 配合pdb使用
在测试代码中使用`breakpoint()`语句暂停执行并进入pdb交互环境：
```python
def test_bing_is_working(page):
    page.goto("https://bing.com")
    breakpoint()
    # ...
```

### 部署到CI 
参见[CI提供商指南](https://playwright.dev/docs/ci)将测试部署到CI/CD环境。

### 异步夹具 
使用异步夹具需安装`pytest-playwright-asyncio`：
```bash
pip install pytest-playwright-asyncio
```
确保使用`pytest-asyncio>=0.26.0`，并在配置中设置`asyncio_default_test_loop_scope = session`（在`pytest.ini`/`pyproject.toml`/`setup.cfg`中）：
```python
import pytest
from playwright.async_api import Page

@pytest.mark.asyncio(loop_scope="session")
async def test_foo(page: Page):
    await page.goto("https://github.com")
    # ...
```

更多信息请访问：[Playwright Python测试运行器文档](https://playwright.dev/python/docs/test-runners)